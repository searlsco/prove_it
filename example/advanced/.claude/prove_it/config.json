{
  "enabled": true,
  "sources": [
    "src/**/*.js",
    "test/**/*.js"
  ],
  "format": {
    "maxOutputChars": 16000
  },
  "hooks": [
    {
      "type": "claude",
      "event": "SessionStart",
      "tasks": [
        {
          "name": "session-briefing",
          "type": "script",
          "command": "prove_it run_builtin session:briefing"
        }
      ]
    },
    {
      "type": "claude",
      "event": "PreToolUse",
      "matcher": "Write|Edit|MultiEdit|NotebookEdit|Bash|mcp__.*",
      "tasks": [
        {
          "name": "lock-config",
          "type": "script",
          "command": "prove_it run_builtin config:lock",
          "quiet": true
        }
      ]
    },
    {
      "type": "claude",
      "event": "Stop",
      "tasks": [
        {
          "name": "fast-tests",
          "type": "script",
          "command": "./script/test_fast"
        },
        {
          "name": "coverage-review",
          "type": "agent",
          "prompt": "Check that calculator code changes have corresponding test coverage, especially edge cases (zero, negative numbers, large values).\n\nRespond with exactly one of:\n- PASS (on a line by itself)\n- FAIL: <reason> (on a line by itself)\n\n{{session_diff}}",
          "model": "haiku",
          "when": {
            "sourceFilesEditedThisTurn": true
          },
          "ruleFile": ".claude/rules/testing.md"
        }
      ]
    },
    {
      "type": "git",
      "event": "pre-commit",
      "tasks": [
        {
          "name": "lint",
          "type": "script",
          "command": "./script/lint.sh"
        },
        {
          "name": "full-tests",
          "type": "script",
          "command": "./script/test"
        },
        {
          "name": "commit-review",
          "type": "agent",
          "prompt": "Review staged changes to the calculator module for:\n1. Division by zero handling\n2. Integer overflow edge cases\n3. Missing test coverage for error paths\n\nRespond with exactly one of:\n- PASS (on a line by itself)\n- FAIL: <reason> (on a line by itself)\n\n{{staged_diff}}",
          "model": "sonnet",
          "when": {
            "variablesPresent": [
              "staged_diff"
            ]
          },
          "ruleFile": ".claude/rules/testing.md"
        },
        {
          "name": "adversarial-review",
          "type": "agent",
          "command": "codex exec -",
          "prompt": "Review staged changes to the calculator module as a second opinion. Look for issues the primary reviewer might miss:\n1. Subtle logic errors or off-by-one mistakes\n2. Unsafe type coercion or NaN propagation\n3. Missing boundary conditions in tests\n\n{{staged_diff}}",
          "ruleFile": ".claude/rules/testing.md"
        }
      ]
    }
  ]
}
